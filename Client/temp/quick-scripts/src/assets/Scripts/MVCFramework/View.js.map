{"version":3,"sources":["assets\\Scripts\\MVCFramework\\View.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Util from \"../Tools/Util\";\nimport { LayerOrderNum, ViewConfigData } from \"../Modules/ViewConfigs\";\nimport ccC from \"../Tools/ccC\";\n\n\nexport default class View\n{\n    public removeMaskClick:boolean = false;\n    public isShow:boolean = false;\n    public isLoadingAsync:boolean = false;\n    // public shouldShowLoading:boolean = false;\n    private clickFuncs:{[btnName:string]:(button:cc.Button,data:any)=>void} = {};\n    private buttonCustomDatas:{[btnName:string]:string} = {};\n    private buttonAudios:{[btnName:string]:string} = {};\n    public showCallback:(finishLoadCallback:(success:boolean,errMsg:string)=>void)=>void = null;\n    public hideCallback:()=>void = null;\n    public transformCache:{[transformName:string]:cc.Node} = {};\n    public name:string = \"\";\n    public layer:LayerOrderNum = LayerOrderNum.UINormal;\n    public isFocus:boolean = false;\n    public node:cc.Node;\n    public onHideViewCallback:()=>void = null;\n    public onShowViewCallback:()=>void = null;\n    public viewConfig:ViewConfigData;\n    public dependentRes:string[] = [];\n\n    //当show调用的时候，如果资源加载期间，调用了hide，应该在show成功后，把view hide掉。\n    private shouldShow = true;\n\n    public Init()\n    {\n        this.removeMaskClick = false;\n        this.isShow = false;\n        this.clickFuncs = {};\n        this.buttonAudios = {};\n        this.buttonCustomDatas = {};\n    }\n\n    //框架调用，上层请勿调用\n    public SetButtonClicks()\n    {\n        for(let btnName in this.clickFuncs)\n        {\n            let tr = this.FindTransform(btnName);\n            if(tr == null)\n            {\n                cc.error(\"SetButtonClicks 不存在 btnName \" + btnName + \" 按钮，添加按钮事件失败 \");\n            }\n            else\n            {\n                let button:cc.Button = tr.getComponent(cc.Button);\n                if(button == null)\n                {\n                    cc.error(\"btnName \" + btnName + \" 没有附加Button组件，添加按钮事件失败 \");\n                }\n                else\n                {\n                    Util.SetClickAction(button,this.clickFuncs[btnName],this.buttonAudios[btnName],this.buttonCustomDatas[btnName]);\n                }\n            }\n        }\n    }\n\n    ////以下是上层可调用的 customData和audioName是可选参数，可不填\n    public SetOnClick(buttonName:string,callback:(button:cc.Button,data:any)=>void,audioName?:string,customData?:string)\n    {\n        this.clickFuncs[buttonName] = callback;\n        this.buttonAudios[buttonName] = audioName;\n        this.buttonCustomDatas[buttonName] = customData;\n    }\n\n    public FindTransform(name):cc.Node\n    {\n        if(this.transformCache[name] != null)\n        {\n            return this.transformCache[name];\n        }\n        else\n        {\n            cc.error(\"FindTransform 不存在transformName \" + name);\n            return null;\n        }\n    }\n\n    public RemoveMaskClick()\n    {\n        this.removeMaskClick = true;\n    }\n\n    //加载依赖资源，全部加载完才会回调show callback\n    public AddDependentRes(resPath)\n    {   \n        this.dependentRes.push(resPath);\n    }\n\n    //Show是异步加载资源，需要callback机制\n    public Show(successCallback:()=>void=null,failCallback:(errMsg:string)=>void=null)\n    {\n        this.shouldShow = true;\n        if(this.isShow == true)\n        {\n            if(successCallback != null)\n                successCallback();\n            return;\n        }\n        if(this.isLoadingAsync == true)\n        {\n            cc.error(\"view \" + name + \" 资源异步请求中，请勿重复调用\");\n            return;\n        }\n        this.showCallback((success:boolean,errMsg:string)=>{\n            if(success == true)\n            {\n                if(successCallback != null)\n                {\n                    successCallback();\n                }\n\n                if(this.shouldShow == false)\n                {\n                    this.Hide();\n                }\n            }\n            else\n            {\n                if(failCallback != null)\n                {\n                    failCallback(errMsg);\n                }\n            }\n        });\n    }\n\n    public Hide()\n    {\n        this.shouldShow = false;\n        if(this.isShow == false)\n        {\n            return;\n        }\n        this.hideCallback();\n    }\n\n    //以下是重写函数\n    public OnAwake()\n    {\n\n    }\n\n    //显示的时候回调\n    public OnShowView()\n    {\n        \n    }\n\n    //隐藏的时候回调\n    public OnHideView()\n    {\n        \n    }\n\n    //当界面去到最前的时候回调\n    public OnFocus()\n    {\n        \n    }\n\n    //当界面从最前切换回非最前的时候回调\n    public OnDisFocus()\n    {\n        \n    }\n\n    //当界面销毁的时候回调\n    public OnDestroy()\n    {\n        \n    }\n\n}\n"]}