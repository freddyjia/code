
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Scripts/JsTool/ImageTool.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6a12eNF521KqJHrpgNOeVLT', 'ImageTool');
// Scripts/JsTool/ImageTool.js

"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ImageTool = ImageTool;

function ImageTool() {}

ImageTool.Get = function (callback) {
  ImageTool.Compelte = callback;
  console.log("ImageTool.GetImageTool.GetImageTool.Get");
  document.getElementById("ImageTool").click();
};

ImageTool.Init = function () {
  //    用于压缩图片的canvas
  ImageTool.canvas = document.createElement("canvas");
  ImageTool.ctx = ImageTool.canvas.getContext('2d'); //    瓦片canvas

  ImageTool.tCanvas = document.createElement("canvas");
  ImageTool.tctx = ImageTool.tCanvas.getContext("2d"); //<input id="file" type="file" class="fileToUpload" style="opacity:0;position:absolute;" onchange="handleFiles(this)"/> 

  var input = document.createElement("input");
  input.style.opacity = 0;
  input.type = "file";
  input.style.position = "absolute";
  input.style.left = '-9999px';

  var fileGet = function fileGet(handler) {
    console.log("fileGetfileGetfileGetfileGet " + handler);
    var maxsize = 100 * 1024;
    var file = input.files[0];

    if (file.type != 'image/png' && file.type != 'image/jpeg') {
      return alert("图片上传格式不正确");
    }

    var fileReader = new FileReader();

    fileReader.onloadend = function () {
      if (fileReader.readyState == fileReader.DONE) {
        // 200kb一下直接上传，否则进行压缩
        if (fileReader.result.length <= maxsize) {
          ImageTool.Compelte(fileReader.result);
        } else {
          var img = new Image();

          img.onload = function () {
            var data = ImageTool.Compress(img);
            ImageTool.Compelte(data);
          };

          img.src = fileReader.result;
        }
      }
    };

    fileReader.readAsDataURL(file);
  };

  input.onchange = fileGet;
  input.id = "ImageTool";
  input.accept = "image/*";
  document.body.appendChild(input);
};

ImageTool.Compress = function (img) {
  var initSize = img.src.length;
  var width = img.width;
  var height = img.height; //如果图片大于四百万像素，计算压缩比并将大小压至400万以下

  var ratio;

  if ((ratio = width * height / 4000000) > 1) {
    ratio = Math.sqrt(ratio);
    width /= ratio;
    height /= ratio;
  } else {
    ratio = 1;
  }

  ImageTool.canvas.width = width;
  ImageTool.canvas.height = height; //铺底色

  ImageTool.ctx.fillStyle = "#fff";
  ImageTool.ctx.fillRect(0, 0, ImageTool.canvas.width, ImageTool.canvas.height); //如果图片像素大于100万则使用瓦片绘制

  var count;

  if ((count = width * height / 1000000) > 1) {
    count = ~~(Math.sqrt(count) + 1); //计算要分成多少块瓦片
    //计算每块瓦片的宽和高

    var nw = ~~(width / count);
    var nh = ~~(height / count);
    ImageTool.tCanvas.width = nw;
    ImageTool.tCanvas.height = nh;

    for (var i = 0; i < count; i++) {
      for (var j = 0; j < count; j++) {
        ImageTool.tctx.drawImage(img, i * nw * ratio, j * nh * ratio, nw * ratio, nh * ratio, 0, 0, nw, nh);
        ImageTool.ctx.drawImage(ImageTool.tCanvas, i * nw, j * nh, nw, nh);
      }
    }
  } else {
    ImageTool.ctx.drawImage(img, 0, 0, width, height);
  } //进行最小压缩


  var ndata = ImageTool.canvas.toDataURL('image/jpeg', 0.1);
  console.log('压缩前：' + initSize);
  console.log('压缩后：' + ndata.length);
  console.log('压缩率：' + ~~(100 * (initSize - ndata.length) / initSize) + "%");
  ImageTool.tCanvas.width = ImageTool.tCanvas.height = ImageTool.canvas.width = ImageTool.canvas.height = 0;
  return ndata;
};

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0c1xcSnNUb29sXFxJbWFnZVRvb2wuanMiXSwibmFtZXMiOlsiSW1hZ2VUb29sIiwiR2V0IiwiY2FsbGJhY2siLCJDb21wZWx0ZSIsImNvbnNvbGUiLCJsb2ciLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY2xpY2siLCJJbml0IiwiY2FudmFzIiwiY3JlYXRlRWxlbWVudCIsImN0eCIsImdldENvbnRleHQiLCJ0Q2FudmFzIiwidGN0eCIsImlucHV0Iiwic3R5bGUiLCJvcGFjaXR5IiwidHlwZSIsInBvc2l0aW9uIiwibGVmdCIsImZpbGVHZXQiLCJoYW5kbGVyIiwibWF4c2l6ZSIsImZpbGUiLCJmaWxlcyIsImFsZXJ0IiwiZmlsZVJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWRlbmQiLCJyZWFkeVN0YXRlIiwiRE9ORSIsInJlc3VsdCIsImxlbmd0aCIsImltZyIsIkltYWdlIiwib25sb2FkIiwiZGF0YSIsIkNvbXByZXNzIiwic3JjIiwicmVhZEFzRGF0YVVSTCIsIm9uY2hhbmdlIiwiaWQiLCJhY2NlcHQiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJpbml0U2l6ZSIsIndpZHRoIiwiaGVpZ2h0IiwicmF0aW8iLCJNYXRoIiwic3FydCIsImZpbGxTdHlsZSIsImZpbGxSZWN0IiwiY291bnQiLCJudyIsIm5oIiwiaSIsImoiLCJkcmF3SW1hZ2UiLCJuZGF0YSIsInRvRGF0YVVSTCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFPLFNBQVNBLFNBQVQsR0FDUCxDQUVDOztBQUVEQSxTQUFTLENBQUNDLEdBQVYsR0FBZ0IsVUFBU0MsUUFBVCxFQUNoQjtBQUNJRixFQUFBQSxTQUFTLENBQUNHLFFBQVYsR0FBcUJELFFBQXJCO0FBQ0FFLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLHlDQUFaO0FBQ0FDLEVBQUFBLFFBQVEsQ0FBQ0MsY0FBVCxDQUF3QixXQUF4QixFQUFxQ0MsS0FBckM7QUFDSCxD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QTNCLEVBQXlDLEdBQXpDLENBQVo7QUFFQTFELEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFNBQVMwQyxRQUFyQjtBQUNBM0MsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksU0FBU3dELEtBQUssQ0FBQzNCLE1BQTNCO0FBQ0E5QixFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxTQUFTLENBQUMsRUFBRSxPQUFPMEMsUUFBUSxHQUFHYyxLQUFLLENBQUMzQixNQUF4QixJQUFrQ2EsUUFBcEMsQ0FBVixHQUEwRCxHQUF0RTtBQUVBL0MsRUFBQUEsU0FBUyxDQUFDYyxPQUFWLENBQWtCa0MsS0FBbEIsR0FBMEJoRCxTQUFTLENBQUNjLE9BQVYsQ0FBa0JtQyxNQUFsQixHQUEyQmpELFNBQVMsQ0FBQ1UsTUFBVixDQUFpQnNDLEtBQWpCLEdBQXlCaEQsU0FBUyxDQUFDVSxNQUFWLENBQWlCdUMsTUFBakIsR0FBMEIsQ0FBeEc7QUFFQSxTQUFPWSxLQUFQO0FBQ0gsQ0F4REQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBJbWFnZVRvb2woKSBcbnsgXG5cbn1cblxuSW1hZ2VUb29sLkdldCA9IGZ1bmN0aW9uKGNhbGxiYWNrKVxue1xuICAgIEltYWdlVG9vbC5Db21wZWx0ZSA9IGNhbGxiYWNrO1xuICAgIGNvbnNvbGUubG9nKFwiSW1hZ2VUb29sLkdldEltYWdlVG9vbC5HZXRJbWFnZVRvb2wuR2V0XCIpXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJJbWFnZVRvb2xcIikuY2xpY2soKVxufVxuXG5JbWFnZVRvb2wuSW5pdCA9IGZ1bmN0aW9uKClcbntcbiAgICAvLyAgICDnlKjkuo7ljovnvKnlm77niYfnmoRjYW52YXNcbiAgICBJbWFnZVRvb2wuY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBJbWFnZVRvb2wuY3R4ID0gSW1hZ2VUb29sLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIC8vICAgIOeTpueJh2NhbnZhc1xuICAgIEltYWdlVG9vbC50Q2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBJbWFnZVRvb2wudGN0eCA9IEltYWdlVG9vbC50Q2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcblxuICAgIC8vPGlucHV0IGlkPVwiZmlsZVwiIHR5cGU9XCJmaWxlXCIgY2xhc3M9XCJmaWxlVG9VcGxvYWRcIiBzdHlsZT1cIm9wYWNpdHk6MDtwb3NpdGlvbjphYnNvbHV0ZTtcIiBvbmNoYW5nZT1cImhhbmRsZUZpbGVzKHRoaXMpXCIvPiBcbiAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgaW5wdXQuc3R5bGUub3BhY2l0eT0wO1xuICAgIGlucHV0LnR5cGUgPSBcImZpbGVcIjtcbiAgICBpbnB1dC5zdHlsZS5wb3NpdGlvbj1cImFic29sdXRlXCI7XG4gICAgaW5wdXQuc3R5bGUubGVmdCA9ICctOTk5OXB4JztcbiAgICB2YXIgZmlsZUdldCA9IGZ1bmN0aW9uKGhhbmRsZXIpe1xuICAgICAgICBjb25zb2xlLmxvZyhcImZpbGVHZXRmaWxlR2V0ZmlsZUdldGZpbGVHZXQgXCIgKyBoYW5kbGVyKTtcblxuICAgICAgICB2YXIgbWF4c2l6ZSA9IDEwMCAqIDEwMjQ7XG4gICAgICAgIHZhciBmaWxlID0gaW5wdXQuZmlsZXNbMF07XG5cbiAgICAgICAgaWYgKGZpbGUudHlwZSAhPSAnaW1hZ2UvcG5nJyAmJiBmaWxlLnR5cGUgIT0gJ2ltYWdlL2pwZWcnKVxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm4gYWxlcnQoXCLlm77niYfkuIrkvKDmoLzlvI/kuI3mraPnoa5cIik7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICAgICAgZmlsZVJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGlmIChmaWxlUmVhZGVyLnJlYWR5U3RhdGUgPT0gZmlsZVJlYWRlci5ET05FKSB7XG5cbiAgICAgICAgICAgICAgICAvLyAyMDBrYuS4gOS4i+ebtOaOpeS4iuS8oO+8jOWQpuWImei/m+ihjOWOi+e8qVxuICAgICAgICAgICAgICAgIGlmIChmaWxlUmVhZGVyLnJlc3VsdC5sZW5ndGggPD0gbWF4c2l6ZSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIEltYWdlVG9vbC5Db21wZWx0ZShmaWxlUmVhZGVyLnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCkgXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gSW1hZ2VUb29sLkNvbXByZXNzKGltZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBJbWFnZVRvb2wuQ29tcGVsdGUoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaW1nLnNyYyA9IGZpbGVSZWFkZXIucmVzdWx0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgICAgIGZpbGVSZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcbiAgICB9XG4gICAgaW5wdXQub25jaGFuZ2UgPSBmaWxlR2V0O1xuICAgIGlucHV0LmlkID0gXCJJbWFnZVRvb2xcIjtcbiAgICBpbnB1dC5hY2NlcHQgPSBcImltYWdlLypcIjtcblxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQgKGlucHV0KTtcblxufVxuXG5JbWFnZVRvb2wuQ29tcHJlc3MgPSBmdW5jdGlvbihpbWcpXG57XG4gICAgdmFyIGluaXRTaXplID0gaW1nLnNyYy5sZW5ndGg7XG4gICAgdmFyIHdpZHRoID0gaW1nLndpZHRoO1xuICAgIHZhciBoZWlnaHQgPSBpbWcuaGVpZ2h0O1xuXG4gICAgLy/lpoLmnpzlm77niYflpKfkuo7lm5vnmb7kuIflg4/ntKDvvIzorqHnrpfljovnvKnmr5TlubblsIblpKflsI/ljovoh7M0MDDkuIfku6XkuItcbiAgICB2YXIgcmF0aW87XG4gICAgaWYgKChyYXRpbyA9IHdpZHRoICogaGVpZ2h0IC8gNDAwMDAwMCk+MSkge1xuICAgICAgICByYXRpbyA9IE1hdGguc3FydChyYXRpbyk7XG4gICAgICAgIHdpZHRoIC89IHJhdGlvO1xuICAgICAgICBoZWlnaHQgLz0gcmF0aW87XG4gICAgfWVsc2Uge1xuICAgICAgICByYXRpbyA9IDE7XG4gICAgfVxuXG4gICAgSW1hZ2VUb29sLmNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgIEltYWdlVG9vbC5jYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuXG4gICAgLy/pk7rlupXoibJcbiAgICBJbWFnZVRvb2wuY3R4LmZpbGxTdHlsZSA9IFwiI2ZmZlwiO1xuICAgIEltYWdlVG9vbC5jdHguZmlsbFJlY3QoMCwgMCwgSW1hZ2VUb29sLmNhbnZhcy53aWR0aCwgSW1hZ2VUb29sLmNhbnZhcy5oZWlnaHQpO1xuXG4gICAgLy/lpoLmnpzlm77niYflg4/ntKDlpKfkuo4xMDDkuIfliJnkvb/nlKjnk6bniYfnu5jliLZcbiAgICB2YXIgY291bnQ7XG4gICAgaWYgKChjb3VudCA9IHdpZHRoICogaGVpZ2h0IC8gMTAwMDAwMCkgPiAxKSB7XG4gICAgICAgIGNvdW50ID0gfn4oTWF0aC5zcXJ0KGNvdW50KSsxKTsgLy/orqHnrpfopoHliIbmiJDlpJrlsJHlnZfnk6bniYdcblxuICAgICAgICAvL+iuoeeul+avj+Wdl+eTpueJh+eahOWuveWSjOmrmFxuICAgICAgICB2YXIgbncgPSB+fih3aWR0aCAvIGNvdW50KTtcbiAgICAgICAgdmFyIG5oID0gfn4oaGVpZ2h0IC8gY291bnQpO1xuXG4gICAgICAgIEltYWdlVG9vbC50Q2FudmFzLndpZHRoID0gbnc7XG4gICAgICAgIEltYWdlVG9vbC50Q2FudmFzLmhlaWdodCA9IG5oO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBjb3VudDsgaisrKSB7XG4gICAgICAgICAgICAgICAgSW1hZ2VUb29sLnRjdHguZHJhd0ltYWdlKGltZywgaSAqIG53ICogcmF0aW8sIGogKiBuaCAqIHJhdGlvLCBudyAqIHJhdGlvLCBuaCAqIHJhdGlvLCAwLCAwLCBudywgbmgpO1xuXG4gICAgICAgICAgICAgICAgSW1hZ2VUb29sLmN0eC5kcmF3SW1hZ2UoSW1hZ2VUb29sLnRDYW52YXMsIGkgKiBudywgaiAqIG5oLCBudywgbmgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgSW1hZ2VUb29sLmN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9XG5cbiAgICAvL+i/m+ihjOacgOWwj+WOi+e8qVxuICAgIHZhciBuZGF0YSA9IEltYWdlVG9vbC5jYW52YXMudG9EYXRhVVJMKCdpbWFnZS9qcGVnJywgMC4xKTtcblxuICAgIGNvbnNvbGUubG9nKCfljovnvKnliY3vvJonICsgaW5pdFNpemUpO1xuICAgIGNvbnNvbGUubG9nKCfljovnvKnlkI7vvJonICsgbmRhdGEubGVuZ3RoKTtcbiAgICBjb25zb2xlLmxvZygn5Y6L57yp546H77yaJyArIH5+KDEwMCAqIChpbml0U2l6ZSAtIG5kYXRhLmxlbmd0aCkgLyBpbml0U2l6ZSkgKyBcIiVcIik7XG5cbiAgICBJbWFnZVRvb2wudENhbnZhcy53aWR0aCA9IEltYWdlVG9vbC50Q2FudmFzLmhlaWdodCA9IEltYWdlVG9vbC5jYW52YXMud2lkdGggPSBJbWFnZVRvb2wuY2FudmFzLmhlaWdodCA9IDA7XG5cbiAgICByZXR1cm4gbmRhdGE7XG59Il19