{"version":3,"sources":["assets\\Scripts\\Components\\ScrollPage.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Util from \"../Tools/Util\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class ScrollPage extends cc.Component \r\n{\r\n    @property(cc.Button)\r\n    public BtnLeft:cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    public BtnRight:cc.Button = null;\r\n\r\n    parentWidth:number = 0;\r\n    initOffset:number = 0;\r\n    scrollView:cc.ScrollView;\r\n    MoveOffset:number = 260*4;\r\n\r\n    private lastOffsetX:number;\r\n    private lastMaxOffsetX:number;\r\n\r\n    onLoad() \r\n    {\r\n        this.scrollView = this.getComponent(cc.ScrollView);\r\n        this.parentWidth = this.scrollView.content.parent.getContentSize().width;\r\n        this.initOffset = this.parentWidth*0.5;\r\n\r\n        /*\r\n        Util.SetScrollViewScrollEvent(\r\n            this.getComponent(cc.ScrollView),\r\n            (scrollView:cc.ScrollView, eventType:cc.ScrollView.EventType, data:any)=>{\r\n                if (eventType == cc.ScrollView.EventType.SCROLL_ENDED)\r\n                {\r\n                    this.OnEndDrag();\r\n                }\r\n            }\r\n        );\r\n        */\r\n\r\n        this.BtnRight.node.active = false;\r\n        this.BtnLeft.node.active = false;\r\n        \r\n        Util.SetClickAction(this.BtnLeft, (btn:cc.Button, data:any)=>{\r\n            this.MoveLeft();\r\n        });\r\n\r\n        Util.SetClickAction(this.BtnRight, (btn:cc.Button, data:any)=>{\r\n            this.MoveRight();\r\n        });\r\n\r\n        this.lastOffsetX = -999;\r\n        this.lastMaxOffsetX = -999;\r\n    }\r\n\r\n    update(dt:number)\r\n    {\r\n        if (this.scrollView.isScrolling())\r\n            return;\r\n        this.ShowButtons();\r\n    }\r\n\r\n    // private OnEndDrag()\r\n    // {\r\n    //     this.ShowButtons();\r\n    // }\r\n\r\n    private ShowButtons()\r\n    {\r\n        if(this.scrollView.getMaxScrollOffset().x < 100)\r\n        {\r\n            if(Math.abs(this.lastMaxOffsetX - this.scrollView.getMaxScrollOffset().x) < 50)\r\n                return;\r\n            this.lastMaxOffsetX = this.scrollView.getMaxScrollOffset().x;\r\n            this.BtnLeft.node.active = false;\r\n            this.BtnRight.node.active = false;\r\n        }\r\n        else\r\n        {\r\n            if(Math.abs(this.lastOffsetX - this.scrollView.getScrollOffset().x) < 50)\r\n                return;\r\n\r\n            this.lastOffsetX = this.scrollView.getScrollOffset().x;\r\n            let scrollOffset = -this.scrollView.getScrollOffset().x / this.scrollView.getMaxScrollOffset().x;\r\n\r\n            if(scrollOffset > 0.2)\r\n            {\r\n                this.BtnLeft.node.active = true;\r\n            }\r\n            else\r\n            {\r\n                this.BtnLeft.node.active = false;\r\n            }\r\n    \r\n            if(scrollOffset < 0.8)\r\n            {\r\n                this.BtnRight.node.active = true;\r\n            }\r\n            else\r\n            {\r\n                this.BtnRight.node.active = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    public MoveLeft()\r\n    {\r\n        let totalWidth = this.scrollView.content.width - this.parentWidth;\r\n        if (totalWidth <= 0)\r\n            return;\r\n\r\n        let oldx = this.scrollView.content.position.x;\r\n        let newx = oldx + this.MoveOffset;\r\n        if (newx > -this.initOffset)\r\n        {\r\n            newx = -this.initOffset;\r\n            this.BtnLeft.node.active = false;\r\n            this.BtnRight.node.active = true;\r\n        }\r\n            \r\n        newx += this.initOffset;\r\n        \r\n        let percent = Math.abs(newx/totalWidth);\r\n        this.scrollView.scrollToPercentHorizontal(percent, 0.1);\r\n    }\r\n\r\n    public MoveRight()\r\n    {\r\n        let totalWidth = this.scrollView.content.width - this.parentWidth;\r\n        if (totalWidth <= 0)\r\n            return;\r\n\r\n        let oldx = this.scrollView.content.position.x;\r\n        let newx = oldx - this.MoveOffset;\r\n        if (newx < -totalWidth)\r\n        {\r\n            newx = -totalWidth;\r\n            this.BtnLeft.node.active = true;\r\n            this.BtnRight.node.active = false;\r\n        }\r\n           \r\n        newx -= this.initOffset;\r\n        \r\n        let percent = Math.abs(newx/totalWidth);\r\n        this.scrollView.scrollToPercentHorizontal(percent, 0.1);\r\n    }\r\n}\r\n"]}